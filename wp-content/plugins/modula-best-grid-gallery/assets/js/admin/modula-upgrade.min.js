!function(a){"use strict";var e={counts:0,completed:0,ajaxRequests:[],ajaxStarted:0,ajaxTimeout:null,init:function(){a("#modula-upgrade-v2").click((function(t){t.preventDefault(),a(this).addClass("updating-message"),e.getGalleries()})),a("#modula-custom-upgrade-v2").click((function(t){t.preventDefault(),a(this).addClass("updating-message");var r=jQuery(".modula-gallery-to-upgrade:checkbox:checked").map((function(){return this.value})).get();e.counts=r.length+1,e.ajaxGalary(r),a("#modula-upgrade-v2").hide(),a(".modula-upgrader-progress-bar-container").show()}))},getGalleries:function(){var t={url:ajaxurl,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"modula-get-old-galleries",nonce:modulaUpgraderHelper.get_galleries_nonce},success:function(t){"succes"==t.status&&(e.counts=t.galleries_ids.length+1,e.ajaxGalary(t.galleries_ids),a("#modula-upgrade-v2").hide(),a(".modula-upgrader-progress-bar-container").show())}};a.ajax(t)},ajaxGalary:function(t){t.forEach((function(t){var r={url:ajaxurl,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"modula-upgrade-gallery",nonce:modulaUpgraderHelper.upgrade_gallery_nonce,gallery_id:t},success:function(t){"succes"==t.status&&(e.completed=e.completed+1,a(".modula-ajax-output").append("<p>"+t.message+"</p>"),e.updateProgress(),e.ajaxStarted=e.ajaxStarted-1)}};e.ajaxRequests.push(r)})),e.runAjaxs()},runAjaxs:function(){for(var t;e.ajaxStarted<5&&e.ajaxRequests.length>0;)e.ajaxStarted=e.ajaxStarted+1,t=e.ajaxRequests.shift(),a.ajax(t);e.ajaxRequests.length>0&&(e.ajaxTimeout=setTimeout((function(){console.log("Delayed 1s"),e.runAjaxs()}),1e3))},updateProgress:function(){var t=e.completed*(100/e.counts)+"%";a(".modula-upgrader-progress-bar-container .modula-upgrader-progress-bar").css("width",t),a(".modula-upgrader-progress-bar-container span").text(t),e.completed==e.counts-1&&e.completeUpgrade()},completeUpgrade:function(){var t={url:ajaxurl,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"modula-complete-upgrade",nonce:modulaUpgraderHelper.upgrade_complete_nonce},success:function(t){"succes"==t.status&&(e.completed=e.completed+1,a(".modula-ajax-output").append("<p>"+t.message+"</p>"),e.updateProgress())}};a.ajax(t)}};a(document).ready((function(){e.init()}))}(jQuery);